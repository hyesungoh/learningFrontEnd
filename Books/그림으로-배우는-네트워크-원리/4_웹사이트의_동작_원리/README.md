# 웹사이트의 동작 원리

## 웹사이트는 어떻게 생겼을까

* 웹사이트는 서버 애플리케이션에서 공개하는 웹페이지의 집합
* 웹페이지를 본다는 것은 브라우저와 웹서버 애플리케이션 사이에서 파일을 전송하는 것

## 웹페이지를 만든다

* HTML을 이용한다

> [스터디 공유를 위한 내용]
> React? UI(마크업)을 위한 라이브러리
> - 런타임에서 UI(HTML)를 만듦 (JavaScript를 이용해서)
> - 서버 자원이 필요 없이 정적 파일만 제공(ex. S3)해도 배포할 수 있음
>  
> Next.js? React 기반 프레임워크
> - 서버 자원을 사용하면, 서버에서 UI를 만들어서 제공 (빌드 타임, 온-디멘드 둘 다 가능)
> - 서버 자원을 사용안하는, 정적 파일만 제공하는 방식도 가능
> - 가장 최신의 기술로는 partial prerendering이 대두됨

## 웹페이지를 보기 좋게 꾸민다

* 스타일 시트를 이용한다
  + 스타일 시트란 디자인을 정의하는 방법
  + CSS (Cascading Style Sheets)

> [스터디 공유를 위한 내용]
> Cascading: 폭포같은, 계속되는, 연속적인
> 즉 계층성(우선순위)을 가진다는 의미

> [스터디 공유를 위한 내용]
> CSS: 근본, 브라우저가 바로 알아들을 수 있음
> SASS (SCSS): CSS pre-processor(전처리기), 더 편하게 작성할 수 있도록 문법 추가, 브라우저가 바로 이해못해서 컴파일 필요
> CSS-in-JS: JavaScript로 CSS를 작성, 런타임에서 CSS를 만들어서 적용, 동적 스타일링에 편함, 모듈 분리도 편하고..
> Zero-runtime CSS-in-JS: 런타임에서 CSS를 만들지 않음, 빌드 타임에 CSS를 만들어서 적용, CSS-in-JS의 런타임 오버헤드 때문에 대두됨

## 웹사이트의 주소

* 웹사이트 주소는 URL(Uniform Resource Locator)로 불림
  + 정식으로는 URI(Uniform Resource Identifier)라고 불리지만, URL이라는 용어가 더 널리, 일반적으로 사용됨

## 웹사이트의 파일을 요청한다

* 브라우저와 웹서버 애플리케이션은 HTTP(S)를 이용해 웹페이지 파일을 송수신
* HTTP는 트랜스포트층의 프로토콜로서 TCP를 이용하므로, HTTP 통신을 하기 전에 TCP 커넥션을 맺음

## 웹사이트의 파일을 전송한다

* HTTP 리퀘스트에 대해 HTTP 리스폰스로 응답
* HTTP 리스폰스에 전송해야 하는 파일이 포함됨
* 파일 크기가 크면 TCP에 의해 분할됨

## 웹사이트 접속 기록을 기억해 둔다

* HTTP 쿠키
  + 웹서버 애플리케이션이 브라우저에 특정 정보를 저장해 두는 기술
  + 웹서버 애플리케이션은 브라우저 요청에 대한 HTTP 리스폰스에 쿠키를 포함하여 보냄 (HTTP 헤더에)
  + 브라우저 설정에 따라 수신한 쿠키를 저장
  + 이후 HTTP 리퀘스트에 저장된 쿠키를 포함해 보냄
  + 이를 이용해 로그인 정보나 사이트 내 열람 이력등을 관리할 수 있음

## 웹사이트 접속을 대행한다

* 프록시 서버
  + 웹사이트 접속을 대행하는 서버
  + Proxy: 대리

* 클라이언트 PC의 브라우저에서 프록시 서버에 접속할 때에는 TCP 포트 번호 8080을 사용하는 경우가 많음

## 직원이 보는 웹사이트를 확인한다

* 관리자가 프록시 서버를 이용하는 목적 중 하나는 클라이언트 PC의 웹브라우저에서 어떤 웹사이트에 접속하는지 확인하는 것
* 부정한 웹사이트에 접속할 수 없게 함
  + URL 필터링에 의해 업무에 불필요한 웹사이트나 성인 사이트 등의 공공의 질서에 반하는 접속하는 것을 방지할 수 있음

> [궁금한 부분]
> 다들 정부에서 접속을 방지하는 사이트에 들어가 본 적이 있는지?
> 전 있는데, (이상한 거 아닙니다 ~)
> 이때는 어떻게 하는 지가 궁금했음. 프록시 서버인가?
>
> 그래서 제 친구한테 물어봤는데 다음과 같이 답변을 해주었어요

```
정부에서 특정 URL에 접근을 차단하고 다른 페이지로 리디렉션하는 것은 여러 네트워크 기술을 활용하여 가능합니다. 주로 사용되는 방법들은 다음과 같습니다:

    DNS 필터링: 정부는 특정 도메인 이름을 차단하기 위해 DNS 필터링을 사용할 수 있습니다. 사용자가 차단된 도메인에 접근하려고 하면, DNS 서버는 해당 도메인의 IP 주소를 제공하지 않거나 다른 IP 주소로 리디렉션합니다. 이로 인해 사용자는 원래 의도한 사이트가 아닌 정부에서 지정한 페이지로 이동하게 됩니다.

    IP 차단: 특정 IP 주소를 차단하는 방법도 있습니다. 네트워크 트래픽을 감시하고, 차단된 IP 주소로의 트래픽을 차단하거나 다른 IP 주소로 리디렉션할 수 있습니다.

    패킷 필터링 및 DPI(Deep Packet Inspection): 네트워크 트래픽을 상세히 분석하여 특정 URL이나 패턴을 감지하고 차단하는 방법입니다. 이 방법은 패킷의 내용을 분석하여 특정 트래픽을 차단하거나 리디렉션할 수 있습니다.

    프록시 서버: 정부는 중앙화된 프록시 서버를 통해 모든 인터넷 트래픽을 통과시키고, 이 프록시 서버에서 특정 URL을 차단하거나 리디렉션할 수 있습니다.

    라우터 및 방화벽 설정: 국가 차원에서 주요 네트워크 라우터나 방화벽을 설정하여 특정 트래픽을 차단할 수 있습니다. 이는 ISP(인터넷 서비스 제공자)와 협력하여 이루어질 수 있습니다.

네트워크적으로 이러한 차단 및 리디렉션 작업은 주로 ISP와 협력하여 국가의 네트워크 인프라를 통해 이루어집니다. 각 나라의 인터넷 검열 정책에 따라 다양한 기술과 방법이 사용될 수 있습니다.
```

## 웹브라우저는 웹서핑만 하는 게 아니다

* 웹 애플리케이션은 웹브라우저를 유저 인터페이스로 이용하는 애플리케이션이다
* 클라이언트 PC 전용 애플리케이션 설치나 업데이트 등이 필요없어진다.

> [스터디 공유를 위한 내용]
> 웹 애플리케이션을 이용해 최초격으로 사업을 성공한 사례는 폴 그레이엄의 viaweb (95년)
> viaweb은 야후에 인수됨 (98년)
> 웹 애플리케이션을 통한 사업 성공의 중요한 사례로 자주 언급됨
>
> 이후 폴 그레이엄은 전세계 탑티어 VC로 불리는 Y Combinator를 설립함
> > 드롭박스, airbnb, 레딧, 트위치 등에 투자
>
> 그가 쓴 해커와 화가라는 책 추천

## 웹사이트를 볼 때의 준비

* 웹 접속에 이용하는 프로토콜 HTTP
  + 트랜스포트층 TCP
  + 인터넷층 IP
  + 네트워크 인터페이스층 이더넷
  + HTTP의 웰노운 포트는 80

* 접속에 URL을 이용
  + URL로부터 IP 주소를 구하기 위해 DNS가 사용
  + 이후 ARP가 사용

## 웹사이트의 흐름

* 웹사이트를 보는 떄의 흐름
  + 웹브라우저에 URL을 입력
  + 웹서버의 IP 주소를 해석 (DNS)
    - DNS 서버에 질의할 떄는 이더넷의 MAC 주소를 구하기 위해 ARP도 실행
  + TCP 커넥션 확립
  + HTTP 리퀘스트, 리스폰스 전송
    - TCP에서 복수로 분할된 웹페이지의 파일을 조립하여 웹브라우저에 그 내용을 표시

> [궁금한 내용]
> URL을 IP 주소로 해석하는 이유는 알겠음
> 근데 MAC 주소가 필요한 이유를 알지 못하겠었음
> 그래서 제 친구한테 물어봤는데 다음과 같이 답변을 해주었어요

```
1. IP 주소 확인: 브라우저가 DNS를 통해 www.example.com의 IP 주소가 192.168.1.1임을 알게 되었습니다.
2. 네트워크 확인: 이제 이 IP 주소가 같은 네트워크 내에 있는지 확인합니다. 예를 들어, 내 컴퓨터의 IP 주소가 192.168.1.2라면, 192.168.1.1은 같은 네트워크에 있습니다.
3. MAC 주소 요청: 내 컴퓨터는 192.168.1.1의 MAC 주소를 알아야 합니다. 이를 위해 ARP 요청을 보냅니다.
    ARP 요청: "192.168.1.1의 MAC 주소가 뭐야?"라고 네트워크에 물어봅니다.
4. ARP 응답: 192.168.1.1에 해당하는 장치가 "내 MAC 주소는 AA:BB:CC:DD:EE:FF야"라고 응답합니다.
5. 데이터 전송: 이제 내 컴퓨터는 192.168.1.1의 MAC 주소를 알게 되었으므로, 데이터를 보낼 때 이 MAC 주소를 사용합니다.

왜 필요한가요?

같은 네트워크 내에서 데이터를 전송할 때, IP 주소만으로는 충분하지 않습니다. 네트워크 장비들은 MAC 주소를 사용하여 데이터를 올바른 장치로 전달합니다. ARP는 이 IP 주소를 MAC 주소로 변환해주는 역할을 합니다.

이렇게 해서 브라우저가 웹 서버와 통신할 수 있게 되는 것입니다!
```

> 이렇게 물어봐서 어떤 느낌인 지는 알겠으나
> 다른 네트워크에서는 어떻게 동작하는지 감을 잡지 못해서
> 친구한테 또 물어봤어요

```
1. 데이터 전송 요청:
컴퓨터 A가 컴퓨터 B로 데이터를 전송하려고 합니다. 컴퓨터 A는 컴퓨터 B의 IP 주소를 알고 있습니다.

2. 라우터 확인:
컴퓨터 A는 컴퓨터 B가 다른 네트워크에 있다는 것을 인지하고, 자신의 기본 게이트웨이(라우터)로 데이터를 전송해야 한다고 판단합니다.

3. ARP 요청 (기본 게이트웨이):
컴퓨터 A는 기본 게이트웨이의 MAC 주소를 알아내기 위해 ARP 요청을 보냅니다. 이 요청은 브로드캐스트 메시지로, 같은 네트워크 내 모든 장치에 전송됩니다. 메시지에는 기본 게이트웨이의 IP 주소가 포함되어 있습니다.

4. ARP 응답 (기본 게이트웨이):
네트워크에 있는 모든 장치는 ARP 요청을 수신합니다. 기본 게이트웨이는 자신의 IP 주소가 포함된 요청을 확인하고, 자신의 MAC 주소를 포함한 ARP 응답을 컴퓨터 A에게 유니캐스트로 전송합니다.

5. MAC 주소 저장 (기본 게이트웨이):
컴퓨터 A는 기본 게이트웨이의 MAC 주소를 ARP 캐시에 저장합니다.

6. 데이터 전송 (기본 게이트웨이로):
컴퓨터 A는 컴퓨터 B의 IP 주소를 대상으로 하는 데이터를 기본 게이트웨이의 MAC 주소로 전송합니다. 이 데이터 프레임은 이더넷 네트워크를 통해 기본 게이트웨이로 전달됩니다.

7. 라우팅:
기본 게이트웨이는 데이터를 수신하고, 목적지 IP 주소를 확인하여 적절한 다음 홉(next hop)으로 데이터를 라우팅합니다. 이 과정에서 여러 중간 라우터를 거칠 수 있습니다.

8. 최종 네트워크 도달:
데이터는 여러 라우터를 거쳐 컴퓨터 B가 속한 네트워크에 도달합니다. 최종 라우터는 컴퓨터 B의 IP 주소를 확인하고, 해당 네트워크 내에서 ARP 요청을 보내 컴퓨터 B의 MAC 주소를 알아냅니다.

9. 최종 데이터 전송:
최종 라우터는 컴퓨터 B의 MAC 주소를 알아낸 후, 데이터를 컴퓨터 B의 MAC 주소로 전송합니다. 컴퓨터 B는 자신의 MAC 주소로 도착한 데이터를 수신하고 처리합니다.

```

> 기본적인 심적 표상이 잡혀있지 않았는데,
> 덕분에 확실히 잡힌 느낌?